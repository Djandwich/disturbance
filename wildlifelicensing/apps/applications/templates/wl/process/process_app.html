{% extends 'wl/base.html' %}

{% load static %}

{% load bootstrap3 %}

{% load jsonify %}

{% block extra_css %}
    <link href="//static.dpaw.wa.gov.au/static/libs/select2/3.5.3/select2.min.css" rel="stylesheet"/>
    <link href="//static.dpaw.wa.gov.au/static/libs/select2-bootstrap-css/1.4.6/select2-bootstrap.css"
          rel="stylesheet"/>
    <link href="{% static 'wl/css/application.css' %}" rel="stylesheet"/>
{% endblock %}

{% block requirements %}
    require(['js/process/process_app', 'js/application_preview'], function (app, applicationPreview) {
        var options = {
            data: {% if dataJSON %} {{ dataJSON|jsonify }} {% else %} {} {% endif %}
        };
        app(options);

        applicationPreview.layoutPreviewItems('#previewContainer', {{ dataJSON|jsonify }}.form_structure, {{ dataJSON|jsonify}}.application.data)
    });
{% endblock %}

{% block breadcrumbs %}
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <ol class="breadcrumb wl-breadcrumbs">
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'dashboard:tables_officer' %}">Tables</a></li>
                    <li class="active">Process Application</li>
                </ol>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <div class="row">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <label>Applicant</label>
                            {% with applicant=dataJSON.application.applicant_persona %}
                                <p>
                                    {{ applicant.user.first_name }} {{ applicant.user.last_name }}
                                    {% if request.user.identification %}
                                        <span class="pull-right">
                                            <a data-toggle="modal" data-target="#idModal">
                                                Show ID
                                            </a>
                                        </span>
                                    {% endif %}
                                <p>{{ applicant.postal_address.search_text }}</p>
                                
                            {% endwith %}
                            <div class="row">
                                <div class="col-md-5">
                                    <label>Lodged on</label>
                                    <p>{{ dataJSON.application.lodged_date }}</p>
                                </div>
                                <div class="col-md-7">
                                    <label>Processing Status</label>
                                    <p>{{ dataJSON.application.processing_status }}</p>
                                </div>
                            </div>
                            <div class="form-group">
                                 <label>Currently assigned to</label>
                                 <input type="hidden" id="assignee" class="form-control"></input>
                                 <a id="assignToMe" class="pull-right">Assign to me</a>
                            </div>
                         </div>
                    </div>
                </div>
                <div class="row">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div class="processing-action-group">
                                <div>
                                    <label>Identity Check</label>
                                    <span class="glyphicon glyphicon-ok pull-right ok hidden"></span>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-xs btn-success">Accept</button>
                                    <button type="button" class="btn btn-xs btn-warning">Request Update</button>
                                </div>
                            </div>
                            <hr>
                            <div class="processing-action-group">
                                <div>
                                    <label>Character Check</label>
                                    <span class="glyphicon glyphicon-ok pull-right ok hidden"></span>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-xs btn-success">Accept</button>
                                </div>
                            </div>
                            <hr>
                            <div class="processing-action-group">
                                <div>
                                    <label>Application Review</label>
                                    <span class="glyphicon glyphicon-ok pull-right ok hidden"></span>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-xs btn-success">Accept</button>
                                    <button type="button" class="btn btn-xs btn-warning">Request Amendments</button>
                                </div>
                            </div>
                            <hr>
                            <div class="processing-action-group">
                                <div>
                                    <label>Departmental Assessment</label>
                                    <span class="glyphicon glyphicon-ok pull-right ok hidden"></span>
                                </div>
                                <div>
                                    <div class="form-group">
                                        Send for assessment
                                        <select class="form-control"></select>
                                    </div>
                                    <button type="button" class="btn btn-xs btn-success">Assessment Complete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-success pull-right" disabled>Approve Application</button>
                    <button type="button" class="btn btn-sm btn-danger">Reject Application</button>
                </div>
            </div>
            <div class="col-md-9">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div id="previewContainer">
                            <h2>{{ dataJSON.application.licence_type.name }}</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% block modals %}
        {% if request.user.identification %}
            <div class="modal fade" id="idModal" tabindex="-1">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Identification for {{ request.user.first_name }} {{ request.user.last_name }}</h4>
                        </div>
                        <div class="modal-body" style="text-align: center">
                            <img src="{{ request.user.identification.file.url }}" />
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endblock %}
{% endblock %}